import numpy as np
import matplotlib.pyplot as plt
import linecache
from matplotlib.backends.backend_pdf import PdfPages
import sys
import os

#Limit Parameter change according to type used
limit_file = 'TestData/TestData/LimitsOfParam/Federtyp_00.typcfg'

with open(limit_file, 'r') as f:
    lines = f.readlines()[22:]
    lines = [line.rstrip('\r\n') for line in lines]
    lines = [line for line in lines if line != ''][1::2]

limit = []
for line in lines:
    l = line.split('=')[1]
    limit.append(float(l))

#Measurement Data change according to type used
file_name = 'TestData/TestData/MeasuramentsData/Federtyp B_1.TXT'
# Get labels
label = linecache.getline(file_name, 11).split(';')[1:]

with open(file_name, 'r') as f:
    lines = f.readlines()[12:]
    
    data = []
    hours = []
    for line in lines:
        date, other = line.split(' ')
        hour = other[0:8]
        data_temp = other[12:].split(';')
        data_temp = [float(d.replace(',', '.')) for d in data_temp[:-1]] #remove '/r/n' (last index)
                
        data.append(data_temp)
        hours.append(hour)
        
data = np.asarray(data)

def plotGraph(data,nameFile):
    pp = PdfPages(nameFile+'.pdf')
    
    n_hours = len(hours)
    for col in range(data.shape[1]):
        fig = plt.figure()
        plt.plot(hours, data[:,col])
        plt.xticks(np.arange(0, len(hours), 20))
        
        # 48 for 1st type, 144 for 2nd type, 240 for 3rd, 336 for 4th
        if col < 48 and limit[col + 48] < max(data[:,col])*2:
            plt.hlines(limit[col + 48], 0, n_hours)
        
        plt.title(label[col])
        plt.grid(True)
        pp.savefig(fig)

    pp.close()

plotGraph(data,'Federtyp B_1')